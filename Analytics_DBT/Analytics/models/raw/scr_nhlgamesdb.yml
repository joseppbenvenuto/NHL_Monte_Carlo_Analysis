version: 2


########################################################################## 
# Tables, descriptions, and tests
##########################################################################

sources:
  # Postgres credentials
  - name: raw
    description: A clone of the nhlgamesdb
    database: nhlgamesdb
    schema: raw
    tables:


########################################################################## 
# Tables, descriptions, and tests
##########################################################################

      # Dates
      ##################################################
      - name: dates
        description: All individual nhl game dates
        columns:

          - name: '"Date_ID"'
            description: unique id per nhl game date (primary key for dates)
            tests:
              - unique
              - not_null

          - name: '"Date"'
            description: unique nhl game date
            tests:
              - unique
              - not_null

      # Game Facts
      ##################################################
      - name: game_facts
        description: All individual nhl game facts
        columns:
          - name: '"Game_Facts_ID"'
            description: unique id per game fact (primary key for game_facts)
          - name: '"Date_ID"'
            description: unique id per nhl game date
          - name: '"Team_ID"'
            description: unique id per nhl team
          - name: '"Opponent_ID"'
            description: unique id per nhl opponent
          - name: '"TOI"'
            description: Total amount of time played
          - name: '"CF"'
            description: Count of Corsi for that team
          - name: '"CA"'	
            description: Count of Corsi against that team
          - name: '"CF%"'	
            description: Percentage of total Corsi in games that team played that are for that team. CF*100/(CF+CA)
          - name: '"FF"'	
            description: Count of Fenwick for that team
          - name: '"FA"'	
            description: Count of Fenwick against that team
          - name: '"FF%"'
            description: Percentage of total Fenwick in games that team played that are for that team. FF*100/(FF+FA)
          - name: '"SF"'	
            description: Count of Shots for that team
          - name: '"SA"'	
            description: Count of Shots against that team
          - name: '"SF%"'	
            description: Percentage of total Shots in games that team played that are for that team. SF*100/(SF+SA)
          - name: '"GF"'	
            description: Count of Goals for that team
          - name: '"GA"'	
            description: Count of Goals against that team
          - name: '"GF%"'	
            description: Percentage of total Goals in games that team played that are for that team. GF*100/(GF+GA)
          - name: Real_Score	
            description: Real score with tie breakers
          - name: Opponent_Real_Score	
            description: Real opponent score with tie breakers
          - name: '"xGF"'	
            description: Expected Goals for
          - name: '"xGA"'	
            description: Expected Goals againts
          - name: '"xGF%"'	
            description: Expected Goals for percentage
          - name: '"SCF"'	
            description: Count of Scoring Chances for that team
          - name: '"SCA"'	
            description: Count of Scoring Chances against that team
          - name: '"SCF%"'	
            description: Percentage of total Scoring Chances in games that team played that are for that team. SCF*100/(SCF+SCA)
          - name: '"HDCF"'	
            description: Count of High Danger Scoring Chances for that team
          - name: '"HDCA"'	
            description: Count of High Danger Scoring Chances against that team
          - name: '"HDCF%"'	
            description: Percentage of total High Danger Scoring Chances in games that team played that are for that team. HDCF*100/(HDCF+HDCA)
          - name: '"HDSF"'	
            description: Count of Shots that are High Danger Scoring Chances for that team
          - name: '"HDSA"'	
            description: Count of Shots that are High Danger Scoring Chances against that team
          - name: '"HDSF%"'	 
            description: Percentage of total Shots that are High Danger Scoring Chances in games that team played that are for that team. HDSF*100/(HDSF+HDSA)
          - name: '"HDGF"'	
            description: Count of Goals off of High Danger Scoring Chances for that team
          - name: '"HDGA"'	
            description: Count of Goals off of High Danger Scoring Chances against that team
          - name: '"HDGF%"'	
            description: Percentage of total Goals off of High Danger Scoring Chances in games that team played that are for that team. HDGF*100/(HDGF+HDGA)
          - name: '"HDSH%"'	
            description: Percentage of High Danger Shots for that team that were Goals. HDGF*100/HDSF
          - name: '"HDSV%"'	
            description: Percentage of High Danger Shots against that team that were not Goals. 100-(HDGA*100/HDSA)
          - name: '"MDCF"'	
            description: Count of Medium Danger Scoring Chances for that team
          - name: '"MDCA"'	
            description: Count of Medium Danger Scoring Chances against that team
          - name: '"MDCF%"'	
            description: Percentage of total Medium Danger Scoring Chances in games that team played that are for that team. MDCF*100/(MDCF+MDCA)
          - name: '"MDSF"'	
            description: Count of Shots that are Medium Danger Scoring Chances for that team
          - name: '"MDSA"'	
            description: Count of Shots that are Medium Danger Scoring Chances against that team
          - name: '"MDSF%"'	
            description: Percentage of total Shots that are Medium Danger Scoring Chances in games that team played that are for that team. MDSF*100/(MDSF+MDSA)
          - name: '"MDGF"'	
            description: Count of Goals off of Medium Danger Scoring Chances for that team
          - name: '"MDGA"'	
            description: Count of Goals off of Medium Danger Scoring Chances against that team
          - name: '"MDGF%"'	
            description: Percentage of total Goals off of Medium Danger Scoring Chances in games that team played that are for that team. MDGF*100/(MDGF+MDGA)
          - name: '"MDSH%"'	
            description: Percentage of Medium Danger Shots for that team that were Goals. MDGF*100/MDSF
          - name: '"MDSV%"'	
            description: Percentage of Medium Danger Shots against that team that were not Goals. 100-(MDGA*100/MDSA)
          - name: '"LDCF"'	
            description: Count of Low Danger Scoring Chances for that team
          - name: '"LDCA"'	
            description: Count of Low Danger Scoring Chances against that team
          - name: '"LDCF%"'	
            description: Percentage of total Low Danger Scoring Chances in games that team played that are for that team. LDCF*100/(LDCF+LDCA)
          - name: '"LDSF"'	
            description: Count of Shots that are Low Danger Scoring Chances for that team
          - name: '"LDSA"'	
            description: Count of Shots that are Low Danger Scoring Chances against that team
          - name: '"LDSF%"'	
            description: Percentage of total Shots that are Low Danger Scoring Chances in games that team played that are for that team. LDSF*100/(LDSF+LDSA)
          - name: '"LDGF"'	
            description: Count of Goals off of Low Danger Scoring Chances for that team
          - name: '"LDGA"'	
            description: Count of Goals off of Low Danger Scoring Chances against that team
          - name: '"LDGF%"'	
            description: Percentage of total Goals off of Low Danger Scoring Chances in games that team played that are for that team. LDGF*100/(LDGF+LDGA)
          - name: '"LDSH%"'	
            description: Percentage of Low Danger Shots for that team that were Goals. LDGF*100/LDSF
          - name: '"LDSV%"'	
            description: Percentage of Low Danger Shots against that team that were not Goals. 100-(LDGA*100/LDSA)
          - name: '"SH%"'	
            description: Percentage of Shots for that team that were Goals. GF*100/SF
          - name: '"SV%"'	
            description: Percentage of Shots against that team that were not Goals. 100-(GA*100/SA)
          - name: '"PDO"'	
            description: Shooting percentage plus save percentage. (GF/SF)+(GA/SA)
          - name: '"Attendance"'	
            description: Game attendance

      
      # Opponents
      ##################################################       
      - name: opponents
        description: All individual nhl game opponents
        columns:

          - name: '"Opponent_ID"'
            description: unique id per nhl game opponent (primary key for opponents)
            tests:
              - unique
              - not_null

          - name: '"Opponent"'
            description: unique nhl game opponent
            tests:
              - unique
              - not_null

      # Teams
      ##################################################
      - name: teams
        description: All individual nhl game teams against opponents
        columns:

          - name: '"Team_ID"'
            description: unique id per nhl team (primary key for teams)
            tests:
              - unique
              - not_null

          - name: '"Team"'
            description: unique nhl team
            tests:
              - unique
              - not_null


########################################################################## 
# Data freshness check
##########################################################################

        # Hypothetical data freshness check when streaming data
          # columns:
            # loaded_at_field: loadedat
            # freshness:
              # Warning after 12 hours
              # warn_after: {count:12, period:hour}
              # Error after 24 hours
              # error_after: {count:24, period:hour}